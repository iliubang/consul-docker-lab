# vim: ft=bzl

genrule(
    name = "config",
    outs = ["config.h"],
    cmd = "\n".join([
        "cat << 'EOF' >$@",
        "#define HAVE_ALLOCA 1",
        "#define HAVE_ALLOCA_H 1",
        "#define HAVE_DLFCN_H 1",
        "#define HAVE_ELF64_RELA 1",
        "#define HAVE_ELF64_R_INFO 1",
        "#define HAVE_ELF64_SYM 1",
        "#define HAVE_ELF_H 1",
        "#define HAVE_INTPTR_T 1",
        "#define HAVE_INTTYPES_H 1",
        "#define HAVE_MALLOC_H 1",
        "#define HAVE_MEMORY_H 1",
        "#define HAVE_REGEX 1",
        "#define HAVE_REGEX_H 1",
        "#define HAVE_STDDEF_H 1",
        "#define HAVE_STDINT_H 1",
        "#define HAVE_STDLIB_H 1",
        "#define HAVE_STRINGS_H 1",
        "#define HAVE_STRING_H 1",
        "#define HAVE_SYS_STAT_H 1",
        "#define HAVE_SYS_TYPES_H 1",
        "#define HAVE_UINTPTR_T 1",
        "#define HAVE_UNISTD_H 1",
        "#define HAVE_UNUSED_ATTRIBUTE 1",
        "#define HAVE_ZLIB 1",
        "#define HAVE_ZLIB_H 1",
        "#define LT_OBJDIR \".libs/\"",
        "#define PACKAGE \"libdwarf\"",
        "#define PACKAGE_BUGREPORT \"libdwarf-list -at- linuxmail -dot- org\"",
        "#define PACKAGE_NAME \"libdwarf\"",
        "#define PACKAGE_STRING \"libdwarf 20191104\"",
        "#define PACKAGE_TARNAME \"libdwarf\"",
        "#define PACKAGE_URL \"\"",
        "#define PACKAGE_VERSION \"20191104\"",
        "#define STDC_HEADERS 1",
        "#define VERSION \"20191104\"",
        "EOF",
    ]),
)

cc_library(
    name = "dwarf",
    srcs = [
        "libdwarf/pro_log_extra_flag_strings.c",
        "libdwarf/pro_reloc_stream.c",
        "libdwarf/pro_arange.c",
        "libdwarf/dwarf_leb.c",
        "libdwarf/dwarf_die_deliv.c",
        "libdwarf/pro_pubnames.c",
        "libdwarf/pro_alloc.c",
        "libdwarf/dwarf_pubtypes.c",
        "libdwarf/malloc_check.c",
        "libdwarf/pro_forms.c",
        "libdwarf/dwarf_names.c",
        "libdwarf/dwarf_macro.c",
        "libdwarf/dwarf_init_finish.c",
        "libdwarf/dwarfstring.c",
        "libdwarf/dwarf_generic_init.c",
        "libdwarf/dwarf_line.c",
        "libdwarf/dwarf_gdbindex.c",
        "libdwarf/dwarf_error.c",
        "libdwarf/dwarf_form.c",
        "libdwarf/dwarf_peread.c",
        "libdwarf/dwarf_str_offsets.c",
        "libdwarf/dwarf_abbrev.c",
        "libdwarf/pro_types.c",
        "libdwarf/pro_dnames.c",
        "libdwarf/pro_reloc_symbolic.c",
        "libdwarf/dwarf_elf_load_headers.c",
        "libdwarf/dwarf_vars.c",
        "libdwarf/dwarf_frame2.c",
        "libdwarf/dwarf_elf_access.c",
        "libdwarf/dwarf_tied.c",
        "libdwarf/dwarf_debuglink.c",
        "libdwarf/dwarf_original_elf_init.c",
        "libdwarf/dwarf_elfread.c",
        "libdwarf/pro_macinfo.c",
        "libdwarf/pro_weaks.c",
        "libdwarf/pro_error.c",
        "libdwarf/pro_expr.c",
        "libdwarf/dwarf_harmless.c",
        "libdwarf/dwarf_xu_index.c",
        "libdwarf/pro_reloc.c",
        "libdwarf/dwarf_object_read_common.c",
        "libdwarf/pro_die.c",
        "libdwarf/pro_frame.c",
        "libdwarf/dwarf_groups.c",
        "libdwarf/pro_funcs.c",
        "libdwarf/dwarf_loc.c",
        "libdwarf/pro_init.c",
        "libdwarf/dwarf_global.c",
        "libdwarf/dwarf_dsc.c",
        "libdwarf/dwarf_frame.c",
        "libdwarf/dwarf_machoread.c",
        "libdwarf/dwarf_alloc.c",
        "libdwarf/pro_finish.c",
        "libdwarf/pro_section.c",
        "libdwarf/dwarf_weaks.c",
        "libdwarf/dwarf_elf_rel_detector.c",
        "libdwarf/dwgetopt.c",
        "libdwarf/gennames.c",
        "libdwarf/dwarf_print_lines.c",
        "libdwarf/dwarf_object_detector.c",
        "libdwarf/dwarf_util.c",
        "libdwarf/pro_encode_nm.c",
        "libdwarf/dwarf_dnames.c",
        "libdwarf/dwarf_stringsection.c",
        "libdwarf/dwarf_types.c",
        "libdwarf/dwarf_query.c",
        "libdwarf/dwarf_tsearchhash.c",
        "libdwarf/pro_vars.c",
        "libdwarf/dwarf_funcs.c",
        "libdwarf/dwarf_macro5.c",
        "libdwarf/pro_line.c",
        "libdwarf/dwarf_ranges.c",
        "libdwarf/dwarf_arange.c",
    ],
    hdrs = [
        "libdwarf/pro_incl.h",
        "libdwarf/dwarf_loc.h",
        "libdwarf/pro_opaque.h",
        "libdwarf/dwarf_abbrev.h",
        "libdwarf/dwarf_elf_reloc_x86_64.h",
        "libdwarf/dwarf_object_read_common.h",
        "libdwarf/dwarf_opaque.h",
        "libdwarf/dwarf_debuglink.h",
        "libdwarf/dwarf_tsearch.h",
        "libdwarf/dwarf_funcs.h",
        "libdwarf/pro_dnames.h",
        "libdwarf/dwarf_elf_reloc_aarch64.h",
        "libdwarf/dwarf_gdbindex.h",
        "libdwarf/dwarf_dsc.h",
        "libdwarf/dwarf_line.h",
        "libdwarf/dwarf_macro.h",
        "libdwarf/dwarf_pe_descr.h",
        "libdwarf/dwarf_macro5.h",
        "libdwarf/dwarf_loc2.h",
        "libdwarf/pro_error.h",
        "libdwarf/dwarf_elf_reloc_mips.h",
        "libdwarf/dwarf_types.h",
        "libdwarf/dwarf_reloc_mips.h",
        "libdwarf/pro_reloc.h",
        "libdwarf/pro_alloc.h",
        "libdwarf/dwarf_base_types.h",
        "libdwarf/dwarf_str_offsets.h",
        "libdwarf/dwarf_reloc_386.h",
        "libdwarf/dwarfstring.h",
        "libdwarf/pro_macinfo.h",
        "libdwarf/pro_util.h",
        "libdwarf/dwarf_reading.h",
        "libdwarf/pro_die.h",
        "libdwarf/malloc_check.h",
        "libdwarf/dwgetopt.h",
        "libdwarf/pro_arange.h",
        "libdwarf/pro_reloc_stream.h",
        "libdwarf/dwarf_elf_rel_detector.h",
        "libdwarf/memcpy_swap.h",
        "libdwarf/dwarf_die_deliv.h",
        "libdwarf/dwarf_reloc_ppc.h",
        "libdwarf/dwarf_elf_reloc_ppc.h",
        "libdwarf/pro_section.h",
        "libdwarf/dwarf_line_table_reader_common.h",
        "libdwarf/dwarf_error.h",
        "libdwarf/dwarf_xu_index.h",
        "libdwarf/pro_expr.h",
        "libdwarf/dwarf_vars.h",
        "libdwarf/pro_reloc_symbolic.h",
        "libdwarf/pro_frame.h",
        "libdwarf/pro_types.h",
        "libdwarf/dwarf_object_detector.h",
        "libdwarf/dwarf_names.h",
        "libdwarf/libdwarf_version.h",
        "libdwarf/dwarf_reloc_x86_64.h",
        "libdwarf/dwarf_names_enum.h",
        "libdwarf/dwarf_errmsg_list.h",
        "libdwarf/libdwarfdefs.h",
        "libdwarf/dwarf_global.h",
        "libdwarf/dwarf_reloc_ppc64.h",
        "libdwarf/dwarf_harmless.h",
        "libdwarf/dwarf_tied_decls.h",
        "libdwarf/dwarf_names_new.h",
        "libdwarf/pro_encode_nm.h",
        "libdwarf/dwarf_util.h",
        "libdwarf/pro_line.h",
        "libdwarf/libdwarf.h",
        "libdwarf/dwarf_weaks.h",
        "libdwarf/dwarf_arange.h",
        "libdwarf/dwarf_elf_reloc_ppc64.h",
        "libdwarf/dwarf_elf_reloc_sparc.h",
        "libdwarf/dwarf_macho_loader.h",
        "libdwarf/dwarf_elf_reloc_arm.h",
        "libdwarf/dwarf_frame.h",
        "libdwarf/dwarf_alloc.h",
        "libdwarf/dwarf_dnames.h",
        "libdwarf/dwarf_reloc_arm.h",
        "libdwarf/dwarf.h",
        "libdwarf/dwarf_elf_reloc_386.h",
        "libdwarf/dwarf_machoread.h",
        "libdwarf/dwarf_elfstructs.h",
        "libdwarf/dwarf_incl.h",
        "libdwarf/dwarf_peread.h",
        "libdwarf/dwarf_elf_access.h",
        "libdwarf/dwarf_elf_defines.h",
        "libdwarf/dwarf_elfread.h",
        "config.h",
    ],
    includes = [".", "libdwarf"],
    copts = ["-w"],
    visibility = ["//visibility:public"],
)
