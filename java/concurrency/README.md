# 并发编程

## Java内存模型和线程安全

### 原子性

> 原子性是指一个操作是不可中断的。即使是在多个线程一起执行的时候，一个操作一旦开始，就不会被其它线程干扰。

**注意：`i++`不是原子操作**

### 有序性

在并发时，程序的执行可能就会出现乱序

```java
class OrderExample {
    int a = 0;
    boolean flag = false;
    
    public void writer() {
        a = 1;
        flag = true;
    }
    
    public void reader() {
        if (flag) {
            int i = a + 1;
            // ...
        }
    }
}
```

一条指令的执行时可以分为很多步骤的

- 取指IF
- 译码和取寄存器操作数ID
- 执行或者有效地址计算EX
- 寄存器访问MEM
- 写回WB

### 可见性

可见性是指当一个线程修改了某一个共享变量的值，其它线程是否能够立即知道这个修改。

- 编译器优化
- 硬件优化（如写吸收，批操作）




